# from torch_geometric.datasets import Planetoid
import tqdm
import torch
import random
import torch.nn.functional as F
import copy
import numpy as np
import os, sys; sys.path.append(os.path.dirname(os.path.realpath("../model")))
from model.mixhop import MixHop
import argparse
from datasets import get_planetoid_dataset


parser = argparse.ArgumentParser()
parser.add_argument('--dataset', type=str, required=True)
parser.add_argument('--runs', type=int, default=10)
parser.add_argument('--epochs', type=int, default=200)
parser.add_argument('--lr', type=float, default=0.003)
parser.add_argument('--weight_decay', type=float, default=0.0005)
parser.add_argument('--max_patience', type=int, default=100)
parser.add_argument('--dropout', type=float, default=0.7)
parser.add_argument('--layer1_pows', nargs='+', type=int, default=[200, 200, 200])
parser.add_argument('--layer2_pows', nargs='+', type=int, default=[100, 100, 100])
args = parser.parse_args()


# load dataset
dataset = get_planetoid_dataset(args.dataset, False)
data = dataset[0]
device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
data.to(device)
real_val_data = data.y[data.val_mask].clone()
print(real_val_data)
num_train = data.train_mask.sum()
num_val = data.val_mask.sum()
# train_val_data = torch.load("../pseudo_label_list/MixHop_{}_label_list.pt".format(args.dataset))
# 461 NO1
# validation accuracy: 0.9389999999999998 +- 0.001843908891458543
# test accuracy: 0.8579000000000001 +- 0.003269556544854366
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 3, 6, 1, 6, 3, 1, 3, 3, 4, 3, 2, 5, 4, 5, 1, 3, 1, 3, 0, 1, 4, 5, 4, 2, 0, 5, 4, 6, 0, 5, 2, 2, 2, 3, 6, 4, 6, 5, 5, 1, 4, 0, 4, 3, 3, 1, 4, 0, 6, 2, 3, 3, 3, 1, 2, 5, 5, 4, 3, 2, 1, 2, 2, 3, 2, 3, 2, 4, 3, 0, 5, 4, 5, 4, 4, 0, 0, 3, 5, 4, 4, 4, 4, 0, 5, 4, 1, 4, 2, 3, 0, 6, 4, 5, 2, 3, 0, 5, 3, 4, 3, 6, 4, 3, 3, 6, 2, 5, 3, 5, 3, 0, 2, 2, 3, 3, 0, 0, 5, 3, 4, 0, 3, 2, 4, 5, 2, 2, 2, 5, 3, 6, 2, 0, 5, 4, 3]
#464 NO2
# validation accuracy: 0.9384 +- 0.0017435595774162405
# test accuracy: 0.8497 +- 0.003925557285278108
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 3, 6, 1, 6, 0, 1, 3, 3, 3, 3, 2, 0, 4, 5, 1, 3, 1, 3, 2, 4, 4, 2, 0, 2, 0, 5, 4, 6, 3, 3, 2, 2, 2, 3, 6, 4, 6, 5, 5, 1, 0, 0, 4, 4, 4, 1, 3, 6, 6, 6, 6, 3, 3, 1, 5, 2, 5, 4, 4, 2, 5, 2, 2, 4, 2, 0, 2, 3, 3, 0, 1, 4, 3, 4, 4, 5, 0, 2, 1, 4, 4, 4, 4, 0, 0, 4, 4, 3, 2, 3, 0, 5, 3, 6, 3, 3, 0, 6, 3, 4, 3, 0, 4, 0, 3, 1, 2, 1, 4, 5, 0, 2, 2, 2, 3, 3, 4, 0, 5, 3, 4, 0, 3, 2, 4, 5, 2, 1, 2, 2, 3, 5, 2, 3, 3, 4, 3]
#474 NO3
# validation accuracy: 0.9507999999999999 +- 0.001326649916142161
# test accuracy: 0.8426 +- 0.004758150901348132
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 4, 6, 1, 6, 3, 1, 3, 3, 3, 3, 2, 5, 4, 5, 5, 3, 1, 3, 3, 4, 4, 2, 0, 2, 0, 5, 4, 0, 0, 3, 2, 2, 2, 2, 6, 4, 6, 5, 5, 1, 0, 0, 4, 3, 3, 1, 3, 6, 6, 2, 3, 3, 3, 1, 2, 2, 5, 4, 3, 2, 1, 2, 2, 3, 2, 3, 2, 3, 3, 0, 5, 3, 3, 4, 4, 0, 0, 2, 1, 4, 4, 4, 4, 0, 5, 4, 4, 4, 2, 3, 0, 6, 3, 5, 2, 3, 0, 4, 3, 4, 3, 0, 3, 3, 3, 1, 2, 1, 4, 5, 3, 2, 2, 2, 4, 3, 4, 0, 5, 4, 4, 1, 3, 2, 4, 5, 2, 3, 2, 2, 3, 5, 2, 2, 4, 4, 1]
#498 NO4
# validation accuracy: 0.9960000000000001 +- 1.1102230246251565e-16
# test accuracy: 0.8583000000000001 +- 0.0026476404589747477
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 4, 6, 1, 6, 3, 1, 3, 3, 3, 3, 2, 5, 4, 5, 5, 3, 1, 3, 3, 4, 4, 2, 0, 2, 0, 5, 4, 0, 0, 3, 2, 2, 2, 2, 6, 4, 6, 5, 5, 1, 0, 0, 4, 3, 3, 1, 3, 6, 6, 2, 3, 3, 3, 1, 2, 2, 5, 4, 3, 2, 1, 2, 2, 3, 2, 3, 2, 3, 3, 0, 5, 4, 3, 3, 4, 5, 3, 2, 1, 4, 4, 4, 4, 0, 5, 4, 1, 3, 0, 3, 4, 6, 3, 6, 3, 3, 3, 6, 3, 4, 3, 6, 3, 0, 3, 1, 2, 5, 6, 5, 2, 0, 2, 2, 3, 3, 0, 3, 5, 3, 4, 0, 3, 2, 4, 5, 2, 3, 2, 2, 3, 5, 2, 0, 3, 4, 3]
#468 NO5
# validation accuracy: 0.9423999999999999 +- 0.001743559577416271
# test accuracy: 0.8407 +- 0.005000999900019999
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 3, 6, 1, 6, 3, 1, 3, 3, 3, 3, 2, 0, 2, 5, 1, 3, 1, 3, 3, 4, 4, 2, 0, 2, 0, 5, 4, 0, 0, 3, 2, 2, 2, 2, 6, 4, 6, 5, 5, 1, 4, 0, 4, 4, 4, 6, 3, 6, 6, 2, 6, 3, 3, 1, 2, 2, 5, 4, 4, 2, 1, 2, 2, 4, 6, 3, 2, 4, 3, 6, 1, 4, 3, 4, 4, 5, 0, 2, 5, 4, 4, 4, 4, 0, 5, 4, 1, 3, 2, 3, 4, 6, 4, 6, 3, 3, 0, 6, 3, 4, 1, 6, 4, 0, 3, 1, 3, 5, 4, 5, 2, 2, 2, 2, 4, 0, 4, 3, 5, 4, 4, 0, 3, 2, 4, 5, 2, 3, 2, 2, 3, 5, 2, 3, 4, 4, 3]
#483 NO6
# validation accuracy: 0.9686 +- 0.0009165151389911689
# test accuracy: 0.8475999999999999 +- 0.008175573374387885
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 4, 6, 1, 6, 3, 1, 3, 3, 3, 3, 2, 5, 4, 5, 5, 3, 1, 3, 3, 4, 4, 2, 0, 2, 0, 5, 4, 0, 0, 3, 2, 2, 2, 2, 6, 4, 6, 5, 5, 1, 0, 0, 4, 3, 3, 1, 3, 6, 6, 2, 3, 3, 3, 1, 2, 2, 5, 4, 3, 2, 1, 2, 2, 3, 2, 3, 2, 3, 3, 0, 5, 3, 3, 4, 4, 0, 0, 2, 1, 4, 4, 4, 4, 0, 5, 4, 4, 3, 2, 3, 4, 6, 2, 5, 3, 3, 0, 6, 3, 4, 3, 6, 3, 0, 3, 1, 2, 5, 5, 5, 3, 6, 2, 2, 3, 3, 4, 3, 5, 4, 4, 1, 3, 2, 4, 5, 2, 2, 2, 2, 3, 5, 2, 3, 3, 4, 3]
#469 NO8
# validation accuracy: 0.9461999999999999 +- 0.0014000000000000013
# test accuracy: 0.8535 +- 0.003201562118716427
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 3, 0, 1, 6, 0, 1, 3, 3, 4, 0, 2, 5, 4, 4, 5, 3, 1, 3, 3, 1, 4, 2, 0, 2, 0, 5, 4, 4, 3, 5, 2, 2, 2, 3, 6, 4, 6, 5, 5, 1, 0, 0, 4, 4, 3, 5, 3, 0, 6, 2, 3, 3, 3, 1, 2, 2, 5, 4, 3, 2, 1, 0, 2, 3, 2, 3, 2, 3, 3, 0, 5, 4, 3, 3, 4, 0, 0, 2, 5, 4, 4, 4, 4, 0, 5, 4, 4, 4, 2, 3, 4, 5, 4, 5, 3, 3, 0, 6, 3, 4, 3, 0, 3, 3, 3, 1, 2, 5, 6, 5, 2, 0, 2, 2, 2, 3, 0, 0, 5, 3, 4, 1, 3, 2, 4, 5, 2, 3, 2, 2, 3, 6, 2, 0, 3, 4, 3]
#477 NO weikai_new
# validation accuracy: 0.9569999999999999 +- 0.0016124515496597114
# test accuracy: 0.8526999999999999 +- 0.006100000000000006
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2,2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0,3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5,3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3,5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 4, 6, 1, 6, 3, 1, 3, 3, 3, 3, 2, 5, 4, 5, 5, 3, 1, 3, 3, 4, 4, 2, 0, 2, 0, 5, 4, 0, 0, 3, 2, 2, 2, 2, 6, 4, 6, 5, 5, 1, 0, 0, 4, 3, 3, 1, 3, 6, 6, 2, 3, 3, 3, 1, 2, 2, 5, 4, 3, 2, 1, 2, 2, 3, 2, 3, 2, 3, 3, 0, 5, 3, 3, 4, 4, 0, 0, 2, 1, 4, 4, 4, 4,0, 4, 4, 4, 3, 0, 3, 4, 5, 3, 5, 4, 3, 3, 4, 3, 4, 2, 6, 3, 3, 4, 1, 2, 5, 4, 5, 3, 2, 2, 2, 3, 3, 4, 0, 5, 5, 4, 1, 3, 2, 4, 5, 2, 2, 4, 2, 3, 5, 2, 3, 3, 4, 3]
#478 NO weikai_old
# validation accuracy: 0.958 +- 0.0
# test accuracy: 0.8498000000000001 +- 0.004166533331199936
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0, 4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3, 3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3, 2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2, 2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5, 4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4, 5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3, 1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0, 3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2, 3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2, 5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4, 3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2, 6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2, 1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6, 5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3, 4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6, 4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 4, 6, 1, 6, 3, 1, 3, 3, 3, 3, 2, 5, 4, 5, 5, 3, 1, 3, 3, 4, 4, 2, 0, 2, 0, 5, 4, 0, 0, 3, 2, 2, 2, 2, 6, 4, 6, 5, 5, 1, 0, 0, 4, 3, 3, 1, 3, 6, 6, 2, 3, 3, 3, 1, 2, 2, 5, 4, 3, 2, 1, 2, 2, 3, 2, 3, 2, 3, 3, 0, 5, 3, 3, 4, 4, 0, 3, 2, 5, 4, 4, 4, 4, 0, 5, 4, 4, 3, 2, 2, 0, 6, 4, 5, 4, 3, 3, 6, 3, 4, 1, 6, 4, 3, 3, 3, 2, 5, 3, 5, 2, 0, 2, 2, 4, 6, 0, 1, 5, 3, 4, 0, 3, 2, 4, 5, 2, 2, 2, 2, 3, 5, 2, 3, 4, 4, 3] 
#479 NO cog
# validation accuracy: 0.9620000000000001 +- 0.0025298221281347057
# test accuracy: 0.8356 +- 0.00793977329651169
# train_val_data = [4, 3, 0, 3, 6, 6, 0, 3, 4, 0, 3, 4, 4, 1, 2, 2, 2, 3, 3, 3, 3, 0,
#        4, 5, 0, 3, 4, 3, 3, 3, 2, 3, 3, 2, 2, 6, 1, 4, 3, 3, 3, 6, 3, 3,
#        3, 3, 0, 4, 2, 2, 6, 5, 3, 5, 4, 0, 4, 3, 4, 4, 3, 3, 2, 4, 0, 3,
#        2, 3, 3, 4, 4, 0, 3, 6, 0, 3, 3, 4, 3, 3, 5, 2, 3, 2, 4, 1, 3, 2,
#        2, 3, 3, 3, 3, 5, 1, 3, 1, 3, 5, 0, 3, 5, 0, 4, 2, 4, 2, 4, 4, 5,
#        4, 3, 5, 3, 3, 4, 3, 0, 4, 5, 0, 3, 6, 2, 5, 5, 5, 3, 2, 3, 0, 4,
#        5, 3, 0, 4, 0, 3, 3, 0, 0, 3, 5, 4, 4, 3, 4, 3, 3, 2, 2, 3, 0, 3,
#        1, 3, 2, 3, 3, 4, 5, 2, 1, 1, 0, 0, 1, 6, 1, 3, 3, 3, 2, 3, 3, 0,
#        3, 4, 1, 3, 4, 3, 2, 0, 0, 4, 2, 3, 2, 1, 4, 6, 3, 2, 0, 3, 3, 2,
#        3, 4, 4, 2, 1, 3, 5, 3, 2, 0, 4, 5, 1, 3, 3, 2, 0, 2, 4, 2, 2, 2,
#        5, 4, 4, 2, 2, 0, 3, 2, 4, 4, 5, 5, 1, 0, 3, 4, 5, 3, 4, 5, 3, 4,
#        3, 3, 1, 4, 3, 3, 5, 2, 3, 2, 5, 5, 4, 3, 3, 3, 3, 1, 5, 3, 3, 2,
#        6, 0, 1, 3, 0, 1, 5, 3, 6, 3, 6, 0, 3, 3, 3, 5, 4, 3, 4, 0, 5, 2,
#        1, 2, 4, 4, 4, 4, 3, 3, 0, 4, 3, 0, 5, 2, 0, 5, 4, 4, 4, 3, 0, 6,
#        5, 2, 4, 5, 1, 3, 5, 3, 0, 3, 5, 1, 1, 0, 3, 4, 2, 6, 2, 0, 5, 3,
#        4, 6, 5, 3, 5, 0, 1, 3, 0, 5, 2, 2, 3, 5, 1, 0, 3, 1, 4, 2, 5, 6,
#        4, 2, 2, 6, 0, 0, 4, 6, 3, 2, 0, 4, 6, 1, 6, 3, 1, 3, 3, 3, 3, 2,
#        5, 4, 5, 5, 3, 1, 3, 3, 4, 4, 2, 0, 2, 0, 5, 4, 0, 0, 3, 2, 2, 2,
#        2, 6, 4, 6, 5, 5, 1, 0, 0, 4, 3, 3, 1, 3, 6, 6, 2, 3, 3, 3, 1, 2,
#        2, 5, 4, 3, 2, 1, 2, 2, 3, 2, 3, 2, 3, 3, 0, 5, 3, 3, 3, 1, 0, 3,
#        2, 5, 5, 4, 4, 4, 0, 5, 4, 4, 3, 2, 3, 0, 6, 3, 5, 3, 3, 3, 4, 3,
#        4, 1, 6, 3, 3, 3, 1, 2, 1, 6, 5, 3, 0, 2, 2, 4, 3, 4, 3, 5, 4, 4,
#        0, 3, 5, 4, 5, 2, 2, 2, 2, 3, 5, 2, 3, 4, 4, 3]

train_val_data = torch.LongTensor(train_val_data).to(device)



def setup_seed(seed):
    random.seed(seed)
    np.random.seed(seed)
    torch.manual_seed(seed)
    torch.cuda.manual_seed(seed)
    torch.cuda.manual_seed_all(seed)
    torch.backends.cudnn.benchmark = False
    torch.backends.cudnn.determinstic = True


def run(extra_hyper_num):
    model = MixHop(dataset.num_features, dataset.num_classes, dropout=args.dropout, 
                layer1_pows=args.layer1_pows, layer2_pows=args.layer2_pows).to(device)
    optimizer = torch.optim.Adam(model.parameters(), lr=args.lr, weight_decay=args.weight_decay)
    best_val_acc = 0
    patience = 0
    epoch = 0
    val_mask_used = data.val_mask.clone()
    val_mask_used[num_train + extra_hyper_num:] = False
    for epoch in range(args.epochs):
        # train
        model.train()
        if extra_hyper_num > 0:
            data.y[val_mask_used] = train_val_data[:extra_hyper_num]
        optimizer.zero_grad()
        out = model(data.x, data.edge_index)
        if extra_hyper_num > 0:
            loss = F.cross_entropy(out[data.train_mask + val_mask_used], data.y[data.train_mask + val_mask_used])
        else:
            loss = F.cross_entropy(out[data.train_mask], data.y[data.train_mask])
        loss.backward()
        optimizer.step()

        # evaluate
        model.eval()
        data.y[data.val_mask] = real_val_data
        with torch.no_grad():
            pred = model(data.x, data.edge_index).argmax(dim=1)
            correct = (pred[data.val_mask] == data.y[data.val_mask]).sum()
            val_acc = int(correct) / int(data.val_mask.sum())
            if val_acc > best_val_acc:
                best_model = copy.deepcopy(model)
                best_val_acc = val_acc
            else:
                if patience == args.max_patience:
                    break
                else:
                    patience = patience + 1
    
    model = best_model
    model.eval()
    with torch.no_grad():
        pred = model(data.x, data.edge_index).argmax(dim=1)
        correct = (pred[data.test_mask] == data.y[data.test_mask]).sum()
        test_acc = int(correct) / int(data.test_mask.sum())
    return best_val_acc, test_acc


if __name__ == '__main__':
    assert len(args.layer1_pows) == 3, 'layer1_pows must have 3 numbers'
    assert len(args.layer2_pows) == 3, 'layer2_pows must have 3 numbers'
    setup_seed(42)
    val_acc_list = []
    test_acc_list = []
    for i in range(10):
        val_acc, test_acc = run(500)
        val_acc_list.append(val_acc)
        test_acc_list.append(test_acc)
    print('validation accuracy: {} +- {}'.format(np.mean(val_acc_list), np.std(val_acc_list)))
    print('test accuracy: {} +- {}'.format(np.mean(test_acc_list), np.std(test_acc_list)))
